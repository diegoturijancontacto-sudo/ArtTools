<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Generador de Catálogo de Arte - Estilo RTBROK</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');

        body {
            background-color: #f3f4f6;
            font-family: 'Roboto', sans-serif;
        }

        .font-serif-pdf {
            font-family: 'Times New Roman', Times, serif;
        }
        
        .font-sans-pdf {
            font-family: Arial, Helvetica, sans-serif;
        }

        .preview-page {
            background: white;
            width: 100%;
            aspect-ratio: 210/297;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            margin-bottom: 2rem;
            color: black;
        }

        .loading-overlay {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(5px);
        }

        @media (max-width: 768px) {
            .mobile-fab-container {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                padding: 1rem;
                z-index: 50;
                border-top: 1px solid #e5e7eb;
            }
            .content-padding-bottom {
                padding-bottom: 100px;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row md:h-screen md:overflow-hidden bg-gray-100">

    <!-- NAVEGACIÓN MÓVIL -->
    <div class="md:hidden bg-slate-900 text-white p-2 sticky top-0 z-40 shadow-md flex justify-around items-center">
        <button onclick="switchTab('editor')" id="tabEditor" class="flex-1 py-2 text-center font-bold border-b-2 border-white">
            <i class="fas fa-edit mr-2"></i>Editar
        </button>
        <button onclick="switchTab('preview')" id="tabPreview" class="flex-1 py-2 text-center text-gray-400 border-b-2 border-transparent">
            <i class="fas fa-eye mr-2"></i>Vista Previa
        </button>
    </div>

    <!-- SECCIÓN IZQUIERDA: EDITOR -->
    <aside id="editorPanel" class="w-full md:w-1/3 lg:w-1/4 bg-white md:border-r border-gray-200 flex flex-col md:h-full z-10 shrink-0">
        <div class="hidden md:block p-5 bg-slate-900 text-white shadow-md shrink-0">
            <h1 class="text-xl font-bold font-serif-pdf"><i class="fas fa-palette mr-2"></i>Catálogo Pro</h1>
        </div>

        <div class="flex-1 p-5 space-y-6 overflow-y-auto content-padding-bottom">
            <!-- 1. PORTADA -->
            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 shadow-sm">
                <h2 class="text-sm font-bold text-slate-700 uppercase mb-3 border-b pb-1 flex items-center">
                    <span class="w-6 h-6 rounded-full bg-slate-900 text-white flex items-center justify-center text-xs mr-2">1</span>
                    Portada
                </h2>
                <div class="space-y-3">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Título / Artista</label>
                        <input type="text" id="artistName" value="" placeholder="CATÁLOGO" class="w-full text-sm p-2 border border-gray-300 rounded font-serif-pdf focus:border-slate-500 outline-none uppercase">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase flex justify-between">
                            Tamaño Título 
                            <span id="titleSizeValue" class="text-slate-900 font-bold">32px</span>
                        </label>
                        <input type="range" id="titleSize" min="20" max="80" value="32" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-slate-900">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Subtítulo</label>
                        <input type="text" id="catalogSubtitle" value="OBRA GENERAL" class="w-full text-sm p-2 border border-gray-300 rounded font-serif-pdf focus:border-slate-500 outline-none uppercase">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-700 uppercase flex items-center"><i class="fas fa-calendar-alt mr-1"></i> Fecha</label>
                        <input type="text" id="updateText" value="ACTUALIZACIÓN FEBRERO 2026" class="w-full text-sm p-2 border-l-4 border-slate-800 bg-white rounded font-sans-pdf focus:ring-1 focus:ring-slate-500 outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-700 uppercase flex items-center"><i class="fas fa-file-contract mr-1"></i> Legal</label>
                        <textarea id="legalNote" rows="2" class="w-full text-[10px] p-2 border-l-4 border-slate-400 bg-white rounded text-gray-700 font-sans-pdf focus:ring-1 focus:ring-slate-500 outline-none">El traslado de la obra requiere una logística de hasta 4 días hábiles, esperamos pueda considerarlo.</textarea>
                    </div>
                </div>
            </div>

            <!-- 2. OBRAS -->
            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 shadow-sm">
                <h2 class="text-sm font-bold text-slate-700 uppercase mb-3 border-b pb-1 flex items-center">
                    <span class="w-6 h-6 rounded-full bg-slate-900 text-white flex items-center justify-center text-xs mr-2">2</span>
                    Obras
                </h2>
                <label class="flex flex-col items-center justify-center w-full h-20 border-2 border-dashed border-slate-300 bg-white rounded-lg cursor-pointer hover:bg-slate-100 transition mb-4 group">
                    <div class="flex flex-col items-center justify-center pt-2 pb-2">
                        <i class="fas fa-plus text-xl text-slate-400 group-hover:text-slate-600 mb-1"></i>
                        <p class="text-xs text-slate-500 font-bold">Añadir Imágenes</p>
                    </div>
                    <input type="file" id="imageInput" class="hidden" multiple accept="image/*">
                </label>
                <div id="artworkList" class="space-y-3">
                    <p class="text-xs text-center text-gray-400 italic py-4" id="emptyMsg">Vacío.</p>
                </div>
            </div>
        </div>

        <div class="hidden md:block p-4 bg-white border-t border-gray-200 shrink-0">
            <button onclick="generatePDF()" class="w-full bg-slate-900 hover:bg-black text-white font-bold py-3 px-4 rounded transition flex items-center justify-center shadow-lg">
                <i class="fas fa-file-pdf mr-2"></i> EXPORTAR CATÁLOGO
            </button>
        </div>
    </aside>

    <!-- SECCIÓN DERECHA: VISTA PREVIA -->
    <main id="previewPanel" class="hidden md:block w-full md:flex-1 bg-gray-300 md:h-full md:overflow-y-auto p-4 md:p-8 relative z-0">
        <div class="max-w-[500px] mx-auto content-padding-bottom" id="previewContainer"></div>
    </main>

    <!-- BOTÓN FLOTANTE MÓVIL -->
    <div class="mobile-fab-container md:hidden">
        <button onclick="generatePDF()" id="mobileGenerateBtn" class="w-full bg-slate-900 active:bg-black text-white font-bold py-3 px-4 rounded-lg shadow-lg flex items-center justify-center text-lg">
            <i class="fas fa-file-download mr-2"></i> DESCARGAR PDF
        </button>
    </div>

    <!-- Loader -->
    <div id="loader" class="fixed inset-0 loading-overlay hidden z-50 flex items-center justify-center flex-col px-4">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-slate-900 mb-4"></div>
        <h3 class="text-xl font-serif-pdf text-slate-900 font-bold text-center">Exportando PDF...</h3>
    </div>

    <script>
        let artworks = [];
        const { jsPDF } = window.jspdf;
        const LOGO_PATH = 'rtbrok_logo.png';

        const imageInput = document.getElementById('imageInput');
        const artworkList = document.getElementById('artworkList');
        const previewContainer = document.getElementById('previewContainer');
        const emptyMsg = document.getElementById('emptyMsg');

        const inputs = {
            artistName: document.getElementById('artistName'),
            titleSize: document.getElementById('titleSize'),
            subtitle: document.getElementById('catalogSubtitle'),
            updateText: document.getElementById('updateText'),
            legalNote: document.getElementById('legalNote')
        };

        Object.keys(inputs).forEach(key => {
            inputs[key].addEventListener('input', () => {
                if (key === 'titleSize') {
                    document.getElementById('titleSizeValue').innerText = inputs[key].value + 'px';
                }
                updatePreview();
            });
        });

        imageInput.addEventListener('change', handleImageUpload);

        function switchTab(tab) {
            const editor = document.getElementById('editorPanel');
            const preview = document.getElementById('previewPanel');
            const tabE = document.getElementById('tabEditor');
            const tabP = document.getElementById('tabPreview');
            if (tab === 'editor') {
                editor.classList.remove('hidden');
                preview.classList.add('hidden');
                tabE.className = "flex-1 py-2 text-center font-bold border-b-2 border-white";
                tabP.className = "flex-1 py-2 text-center text-gray-400 border-b-2 border-transparent";
            } else {
                editor.classList.add('hidden');
                preview.classList.remove('hidden');
                tabP.className = "flex-1 py-2 text-center font-bold border-b-2 border-white";
                tabE.className = "flex-1 py-2 text-center text-gray-400 border-b-2 border-transparent";
            }
        }

        function handleImageUpload(e) {
            const files = Array.from(e.target.files);
            if (files.length > 0) emptyMsg.style.display = 'none';
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const artwork = {
                        id: Date.now() + Math.random(),
                        image: event.target.result,
                        title: "TÍTULO DE LA OBRA",
                        medium: "ÓLEO SOBRE TELA",
                        dimensions: "120 x 100 CM",
                        code: "CAT-" + Math.floor(1000 + Math.random() * 9000),
                        isUnique: false
                    };
                    artworks.push(artwork);
                    renderArtworkList();
                    updatePreview();
                };
                reader.readAsDataURL(file);
            });
            e.target.value = '';
        }

        function renderArtworkList() {
            artworkList.innerHTML = '';
            if (artworks.length === 0) {
                artworkList.appendChild(emptyMsg);
                emptyMsg.style.display = 'block';
                return;
            }
            artworks.forEach((art, index) => {
                const div = document.createElement('div');
                div.className = 'bg-white p-3 rounded border border-gray-200 shadow-sm mb-3';
                div.innerHTML = `
                    <div class="flex gap-3 mb-2 items-start">
                        <img src="${art.image}" class="w-16 h-16 object-cover rounded border">
                        <div class="flex-1 space-y-2">
                            <input type="text" value="${art.title}" oninput="updateArtwork('${art.id}', 'title', this.value.toUpperCase())" class="w-full text-xs p-1 border rounded font-bold outline-none uppercase font-serif-pdf">
                            <div class="grid grid-cols-2 gap-1">
                                <input type="text" value="${art.medium}" oninput="updateArtwork('${art.id}', 'medium', this.value.toUpperCase())" class="text-[9px] p-1 border rounded outline-none uppercase">
                                <input type="text" value="${art.dimensions}" oninput="updateArtwork('${art.id}', 'dimensions', this.value.toUpperCase())" class="text-[9px] p-1 border rounded outline-none uppercase">
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center text-xs">
                         <div class="flex items-center gap-2">
                            <input type="text" value="${art.code}" oninput="updateArtwork('${art.id}', 'code', this.value.toUpperCase())" class="text-[9px] p-1 border rounded bg-gray-50 outline-none w-16">
                            <label class="flex items-center text-[9px] text-gray-500 cursor-pointer">
                                <input type="checkbox" ${art.isUnique ? 'checked' : ''} onchange="updateArtwork('${art.id}', 'isUnique', this.checked)" class="mr-1">
                                Obra única
                            </label>
                         </div>
                         <div class="flex gap-2">
                             <button onclick="moveArtwork(${index}, -1)" class="text-gray-400 hover:text-black"><i class="fas fa-chevron-up"></i></button>
                             <button onclick="moveArtwork(${index}, 1)" class="text-gray-400 hover:text-black"><i class="fas fa-chevron-down"></i></button>
                             <button onclick="deleteArtwork('${art.id}')" class="text-gray-300 hover:text-red-500"><i class="fas fa-trash"></i></button>
                         </div>
                    </div>
                `;
                artworkList.appendChild(div);
            });
        }

        function updateArtwork(id, field, value) {
            const art = artworks.find(a => a.id == id);
            if (art) { art[field] = value; updatePreview(); }
        }

        function deleteArtwork(id) {
            artworks = artworks.filter(a => a.id != id);
            renderArtworkList();
            updatePreview();
        }

        function moveArtwork(index, direction) {
            if (direction === -1 && index > 0) [artworks[index], artworks[index - 1]] = [artworks[index - 1], artworks[index]];
            else if (direction === 1 && index < artworks.length - 1) [artworks[index], artworks[index + 1]] = [artworks[index + 1], artworks[index]];
            renderArtworkList(); updatePreview();
        }

        function updatePreview() {
            previewContainer.innerHTML = '';
            const artistVal = inputs.artistName.value.trim() || "CATÁLOGO";
            const subVal = inputs.subtitle.value.trim() || "OBRA GENERAL";
            const titleSize = inputs.titleSize.value + 'px';

            // PORTADA
            const cover = document.createElement('div');
            cover.className = 'preview-page p-12 flex flex-col items-center justify-between text-center font-serif-pdf';
            cover.innerHTML = `
                <!-- Logo centrado en Y con el título -->
                <div class="absolute inset-0 flex items-center justify-center opacity-[0.08] grayscale z-0 overflow-hidden pointer-events-none">
                     <!-- El mt-24 compensa el margen del contenedor de arriba para quedar justo tras él -->
                     <img src="${LOGO_PATH}" class="w-[85mm] max-w-none transform translate-y-[-55px]" onerror="this.style.display='none'">
                </div>

                <!-- Bloque superior: Título y Subtítulo -->
                <div class="relative z-10 flex flex-col items-center w-full mt-24">
                    <h1 class="tracking-[0.3em] mb-4 font-normal uppercase px-4" style="font-size: ${titleSize}; line-height: 1.1;">${artistVal}</h1>
                    <h2 class="text-xs tracking-[0.4em] uppercase opacity-60">${subVal}</h2>
                </div>
                
                <!-- Bloque Central: Fecha -->
                <div class="relative z-10 w-full flex flex-col items-center">
                    <p class="text-[10px] font-sans-pdf tracking-[0.2em] uppercase font-bold text-slate-800">${inputs.updateText.value}</p>
                </div>

                <!-- Bloque inferior: Nota Legal -->
                <div class="relative z-10 w-full mb-12">
                    <p class="text-[9px] text-gray-500 font-sans-pdf leading-relaxed max-w-[320px] mx-auto italic opacity-80">${inputs.legalNote.value}</p>
                </div>
            `;
            previewContainer.appendChild(cover);

            artworks.forEach((art, i) => {
                const page = document.createElement('div');
                page.className = 'preview-page p-12 flex flex-col justify-between font-serif-pdf';
                page.innerHTML = `
                    <div class="flex-1 flex items-center justify-center py-6">
                        <img src="${art.image}" class="max-h-[85%] max-w-full object-contain shadow-xl relative z-10">
                    </div>
                    <div class="relative pt-8 flex flex-col items-center">
                        <div class="mb-4 relative z-10 text-right w-full">
                            <p class="text-base tracking-tight leading-relaxed">
                                <span class="italic">"${art.title}"</span>
                                ${art.isUnique ? `
                                    <span class="text-[10px] font-sans-pdf mx-2 opacity-30">|</span>
                                    <span class="text-[10px] font-sans-pdf uppercase tracking-widest text-gray-400">Obra única</span>
                                ` : ''}
                                <span class="text-[10px] font-sans-pdf mx-2 opacity-30">|</span>
                                <span class="text-[11px] font-sans-pdf uppercase tracking-wider">${art.medium}</span>
                                <span class="text-[10px] font-sans-pdf mx-2 opacity-30">|</span>
                                <span class="text-[11px] font-sans-pdf">${art.dimensions}</span>
                                <span class="text-[10px] font-sans-pdf mx-2 opacity-30">|</span>
                                <span class="text-[10px] font-sans-pdf bg-black text-white px-2 py-0.5 font-bold">${art.code}</span>
                            </p>
                        </div>
                        <div class="flex justify-between items-center pt-2 font-sans-pdf text-[9px] text-gray-400 uppercase tracking-widest relative z-10 border-t border-gray-100 w-full">
                             <p class="font-bold">${artistVal}</p>
                             <!-- Marca de agua de pie alineada al nivel de los textos -->
                             <img src="${LOGO_PATH}" class="w-8 opacity-[0.1] grayscale absolute left-1/2 transform -translate-x-1/2" onerror="this.style.display='none'">
                             <p>PÁGINA ${i + 1}</p>
                        </div>
                    </div>
                `;
                previewContainer.appendChild(page);
            });
        }

        async function generatePDF() {
            const loader = document.getElementById('loader');
            loader.classList.remove('hidden');
            try {
                const doc = new jsPDF('p', 'mm', 'a4');
                const pageWidth = 210;
                const pageHeight = 297;
                const artistVal = inputs.artistName.value.trim() || "CATÁLOGO";
                const subVal = inputs.subtitle.value.trim() || "OBRA GENERAL";
                const pdfTitleSize = parseInt(inputs.titleSize.value);

                let logoData = null;
                try {
                    const response = await fetch(LOGO_PATH);
                    const blob = await response.blob();
                    logoData = await new Promise(resolve => {
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result);
                        reader.readAsDataURL(blob);
                    });
                } catch (e) {}

                // --- PORTADA ---
                const titleY = 85;

                if (logoData) {
                    doc.saveGraphicsState();
                    doc.setGState(new doc.GState({ opacity: 0.08 }));
                    const logoSize = 85; 
                    // Centrado exactamente en el eje Y del título (ajustado offset de renderizado de texto)
                    doc.addImage(logoData, 'PNG', (pageWidth - logoSize) / 2, titleY - (logoSize/2) - 2, logoSize, logoSize);
                    doc.restoreGraphicsState();
                }

                doc.setTextColor(0);
                doc.setFont("times", "normal");
                doc.setFontSize(pdfTitleSize);
                const spacedTitle = artistVal.toUpperCase().split('').join('  ');
                doc.text(spacedTitle, pageWidth / 2, titleY, { align: "center", maxWidth: 170 });
                
                doc.setFontSize(10);
                const spacedSub = subVal.toUpperCase().split('').join('   ');
                doc.text(spacedSub, pageWidth / 2, titleY + 12, { align: "center" });

                const legalY = 265;
                doc.setFont("helvetica", "italic");
                doc.setFontSize(8);
                doc.setTextColor(100);
                const legalLines = doc.splitTextToSize(inputs.legalNote.value, 110);
                doc.text(legalLines, pageWidth / 2, legalY, { align: "center" });

                const dateY = (titleY + 12 + legalY) / 2;
                doc.setTextColor(0);
                doc.setFont("helvetica", "bold");
                doc.setFontSize(9);
                doc.text(inputs.updateText.value.toUpperCase(), pageWidth / 2, dateY, { align: "center" });

                // --- OBRAS ---
                for (let i = 0; i < artworks.length; i++) {
                    doc.addPage();
                    const art = artworks[i];
                    const margin = 25;
                    const maxW = pageWidth - (margin * 2);
                    const maxH = 180;
                    
                    const img = new Image();
                    img.src = art.image;
                    await new Promise(r => img.onload = r);
                    
                    let rW = maxW, rH = (img.height * maxW) / img.width;
                    if (rH > maxH) { rH = maxH; rW = (img.width * maxH) / img.height; }

                    doc.addImage(art.image, 'JPEG', margin + (maxW - rW) / 2, 45 + (maxH - rH) / 2, rW, rH);

                    // Logo pie de página alineado horizontalmente con los textos finales
                    if (logoData) {
                        doc.saveGraphicsState();
                        doc.setGState(new doc.GState({ opacity: 0.08 }));
                        const footerLogoSize = 12; // Muy pequeño para alinear con texto
                        doc.addImage(logoData, 'PNG', (pageWidth - footerLogoSize) / 2, pageHeight - 16, footerLogoSize, footerLogoSize);
                        doc.restoreGraphicsState();
                    }

                    const infoY = 250;
                    doc.setTextColor(0);
                    doc.setFont("times", "italic");
                    doc.setFontSize(14);
                    doc.text(`"${art.title}"`, pageWidth - margin, infoY + 8, { align: "right" });
                    
                    doc.setFont("helvetica", "normal");
                    doc.setFontSize(9);
                    doc.setTextColor(80);
                    
                    let detailParts = [];
                    if (art.isUnique) detailParts.push("OBRA ÚNICA");
                    detailParts.push(art.medium);
                    detailParts.push(art.dimensions);
                    detailParts.push(art.code);
                    
                    const details = detailParts.join('   |   ');
                    doc.text(details.toUpperCase(), pageWidth - margin, infoY + 16, { align: "right" });

                    doc.setFontSize(8);
                    doc.setTextColor(160);
                    doc.setFont("helvetica", "bold");
                    doc.text(artistVal.toUpperCase(), margin, pageHeight - 12);
                    doc.setFont("helvetica", "normal");
                    doc.text(`PÁGINA ${i + 1}`, pageWidth - margin, pageHeight - 12, { align: "right" });
                }

                doc.save(`CATALOGO_${artistVal.replace(/\s+/g, '_')}.pdf`);
            } catch (e) {
                console.error(e);
            } finally {
                loader.classList.add('hidden');
            }
        }
        updatePreview();
    </script>
</body>
</html>
