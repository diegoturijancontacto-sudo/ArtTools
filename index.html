<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Catálogo de Arte - Estilo Galería</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400&display=swap');

        body {
            background-color: #f3f4f6;
            font-family: 'Roboto', sans-serif;
        }

        /* Vista previa en pantalla simula papel */
        .preview-page {
            background: white;
            width: 100%;
            aspect-ratio: 210/297; /* A4 Ratio */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            margin-bottom: 2rem;
        }

        /* Tipografía específica del catálogo */
        .font-serif-cat {
            font-family: 'Times New Roman', Times, serif;
        }
        
        .loading-overlay {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- BARRA LATERAL: EDITOR (Donde se ingresan los datos rojos) -->
    <aside class="w-full md:w-1/3 lg:w-1/4 bg-white border-r border-gray-200 flex flex-col h-full shadow-lg z-10">
        <div class="p-5 bg-slate-800 text-white shadow-md">
            <h1 class="text-xl font-bold font-serif-cat"><i class="fas fa-palette mr-2"></i>Editor de Catálogo</h1>
            <p class="text-xs text-slate-300 mt-1">Configura los textos "rojos" y sube obras.</p>
        </div>

        <div class="flex-1 overflow-y-auto p-5 space-y-6">
            
            <!-- SECCIÓN 1: PORTADA (Datos Rojos 1) -->
            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                <h2 class="text-sm font-bold text-slate-700 uppercase mb-3 border-b pb-1">
                    <i class="fas fa-book-open mr-1"></i> Configuración Portada
                </h2>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Artista (Título Principal)</label>
                        <input type="text" id="artistName" value="CARLOS OVIEDO" class="w-full text-sm p-2 border border-gray-300 rounded focus:ring-2 focus:ring-slate-500 outline-none font-serif-cat">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Subtítulo</label>
                        <input type="text" id="catalogSubtitle" value="CATÁLOGO DE OBRA DISPONIBLE" class="w-full text-sm p-2 border border-gray-300 rounded focus:ring-2 focus:ring-slate-500 outline-none font-serif-cat">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-red-500 mb-1">Texto Actualización (Rojo en muestra)</label>
                        <input type="text" id="updateText" value="ACTUALIZACIÓN DICIEMBRE 2024" class="w-full text-sm p-2 border border-red-200 bg-red-50 rounded focus:ring-2 focus:ring-red-500 outline-none text-red-700">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-red-500 mb-1">Nota Legal (Pie de portada)</label>
                        <textarea id="legalNote" rows="3" class="w-full text-xs p-2 border border-red-200 bg-red-50 rounded focus:ring-2 focus:ring-red-500 outline-none text-red-700">El traslado de la obra requiere una logística de hasta 4 días hábiles, esperamos pueda considerarlo.</textarea>
                    </div>
                </div>
            </div>

            <!-- SECCIÓN 2: OBRAS (Datos Rojos 2) -->
            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                <h2 class="text-sm font-bold text-slate-700 uppercase mb-3 border-b pb-1">
                    <i class="fas fa-images mr-1"></i> Gestión de Obras
                </h2>
                
                <!-- Botón Subir -->
                <label class="flex items-center justify-center w-full h-24 border-2 border-dashed border-slate-300 rounded-lg cursor-pointer hover:bg-slate-100 transition mb-4">
                    <div class="text-center">
                        <i class="fas fa-cloud-upload-alt text-2xl text-slate-400"></i>
                        <p class="text-xs text-slate-500 mt-1">Click para agregar imágenes</p>
                    </div>
                    <input type="file" id="imageInput" class="hidden" multiple accept="image/*">
                </label>

                <!-- Lista de Obras -->
                <div id="artworkList" class="space-y-3">
                    <!-- Los items se generarán aquí con JS -->
                    <p class="text-xs text-center text-gray-400 italic" id="emptyMsg">No hay obras cargadas</p>
                </div>
            </div>

            <!-- SECCIÓN 3: PIE DE PÁGINA GLOBAL -->
            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-10">
                <h2 class="text-sm font-bold text-slate-700 uppercase mb-3 border-b pb-1">
                    <i class="fas fa-shoe-prints mr-1"></i> Pie de Página (Global)
                </h2>
                <div>
                    <label class="block text-xs font-medium text-red-500 mb-1">Texto de disponibilidad</label>
                    <input type="text" id="footerAvailability" value="Obra disponible Diciembre 2024" class="w-full text-sm p-2 border border-red-200 bg-red-50 rounded focus:ring-2 focus:ring-red-500 outline-none text-red-700">
                </div>
            </div>
        </div>

        <!-- Botón Generar -->
        <div class="p-4 bg-white border-t border-gray-200">
            <button onclick="generatePDF()" id="generateBtn" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 px-4 rounded transition flex items-center justify-center shadow-lg">
                <i class="fas fa-file-pdf mr-2"></i> DESCARGAR PDF
            </button>
        </div>
    </aside>

    <!-- ÁREA PRINCIPAL: VISTA PREVIA -->
    <main class="flex-1 bg-gray-200 h-full overflow-y-auto p-8 relative">
        <div class="max-w-[600px] mx-auto" id="previewContainer">
            <!-- La vista previa HTML se renderiza aquí -->
            
            <!-- Portada Preview -->
            <div class="preview-page p-12 flex flex-col justify-between items-center text-center font-serif-cat">
                <div class="flex-1 flex flex-col justify-center w-full">
                    <!-- Líneas guía decorativas (simuladas) -->
                    <div class="absolute inset-0 pointer-events-none opacity-10">
                        <div class="h-full w-px bg-purple-500 absolute left-1/4"></div>
                        <div class="h-full w-px bg-purple-500 absolute right-1/4"></div>
                    </div>

                    <h1 class="text-5xl tracking-widest mb-4 uppercase" id="prevArtist">CARLOS OVIEDO</h1>
                    <div class="w-full h-px bg-gray-300 my-2"></div>
                    <h2 class="text-xl tracking-wide uppercase mt-2" id="prevSubtitle">CATÁLOGO DE OBRA DISPONIBLE</h2>
                    <div class="w-full h-px bg-gray-300 my-2"></div>
                </div>
                
                <div class="w-full pb-10">
                    <p class="text-sm font-bold tracking-widest uppercase mb-2 border-t border-b border-gray-300 py-1 inline-block" id="prevUpdate">ACTUALIZACIÓN DICIEMBRE 2024</p>
                    <p class="text-xs text-gray-500 mt-2 italic px-10" id="prevLegal">El traslado de la obra requiere una logística de hasta 4 días hábiles...</p>
                </div>
            </div>

            <!-- Ejemplo de página interior (Placeholder) -->
            <div class="preview-page p-12 flex flex-col items-center justify-between font-serif-cat opacity-50">
                <div class="flex-1 w-full flex items-center justify-center bg-gray-50 mb-4">
                    <p class="text-gray-400">Las páginas de las obras se generarán aquí...</p>
                </div>
            </div>

        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loader" class="fixed inset-0 loading-overlay hidden z-50 flex items-center justify-center flex-col">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-slate-800 mb-4"></div>
        <h3 class="text-xl font-serif-cat text-slate-800">Generando Catálogo PDF...</h3>
        <p class="text-gray-500">Procesando imágenes en alta resolución</p>
    </div>

    <script>
        // Estado Global
        let artworks = [];
        const { jsPDF } = window.jspdf;

        // Referencias DOM
        const imageInput = document.getElementById('imageInput');
        const artworkList = document.getElementById('artworkList');
        const previewContainer = document.getElementById('previewContainer');
        const emptyMsg = document.getElementById('emptyMsg');

        // Inputs Globales
        const inputs = {
            artistName: document.getElementById('artistName'),
            subtitle: document.getElementById('catalogSubtitle'),
            updateText: document.getElementById('updateText'),
            legalNote: document.getElementById('legalNote'),
            footerAvailability: document.getElementById('footerAvailability')
        };

        // Listeners para actualizar vista previa en tiempo real
        Object.keys(inputs).forEach(key => {
            inputs[key].addEventListener('input', updatePreview);
        });

        imageInput.addEventListener('change', handleImageUpload);

        function handleImageUpload(e) {
            const files = Array.from(e.target.files);
            if(files.length > 0) emptyMsg.style.display = 'none';

            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const artwork = {
                        id: Date.now() + Math.random(),
                        image: event.target.result,
                        title: "Título de la obra",
                        medium: "Óleo sobre tela",
                        dimensions: "100 x 100 cm",
                        code: "COD01"
                    };
                    artworks.push(artwork);
                    renderArtworkList();
                    updatePreview();
                };
                reader.readAsDataURL(file);
            });
            e.target.value = ''; // Reset input
        }

        function renderArtworkList() {
            artworkList.innerHTML = '';
            if(artworks.length === 0) {
                artworkList.appendChild(emptyMsg);
                emptyMsg.style.display = 'block';
                return;
            }

            artworks.forEach((art, index) => {
                const div = document.createElement('div');
                div.className = 'bg-white p-3 rounded border border-gray-200 shadow-sm relative group';
                div.innerHTML = `
                    <div class="flex gap-3 mb-2">
                        <img src="${art.image}" class="w-16 h-16 object-cover rounded bg-gray-100">
                        <div class="flex-1 min-w-0 space-y-2">
                            <input type="text" placeholder="Título" value="${art.title}" 
                                oninput="updateArtwork('${art.id}', 'title', this.value)"
                                class="w-full text-xs p-1 border rounded font-bold">
                            <div class="flex gap-1">
                                <input type="text" placeholder="Técnica" value="${art.medium}" 
                                    oninput="updateArtwork('${art.id}', 'medium', this.value)"
                                    class="w-1/2 text-xs p-1 border rounded">
                                <input type="text" placeholder="Medidas" value="${art.dimensions}" 
                                    oninput="updateArtwork('${art.id}', 'dimensions', this.value)"
                                    class="w-1/2 text-xs p-1 border rounded">
                            </div>
                            <input type="text" placeholder="Código" value="${art.code}" 
                                oninput="updateArtwork('${art.id}', 'code', this.value)"
                                class="w-full text-xs p-1 border rounded bg-slate-50">
                        </div>
                    </div>
                    <div class="flex justify-between items-center mt-2 pt-2 border-t border-gray-100">
                        <span class="text-xs font-bold text-gray-400">#${index + 1}</span>
                        <div class="flex gap-2">
                            <button onclick="moveArtwork(${index}, -1)" class="text-gray-400 hover:text-blue-500" title="Subir"><i class="fas fa-arrow-up"></i></button>
                            <button onclick="moveArtwork(${index}, 1)" class="text-gray-400 hover:text-blue-500" title="Bajar"><i class="fas fa-arrow-down"></i></button>
                            <button onclick="deleteArtwork('${art.id}')" class="text-red-400 hover:text-red-600" title="Eliminar"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
                artworkList.appendChild(div);
            });
        }

        function updateArtwork(id, field, value) {
            const art = artworks.find(a => a.id == id);
            if(art) {
                art[field] = value;
                updatePreview(); // Actualizar visualización
            }
        }

        function deleteArtwork(id) {
            artworks = artworks.filter(a => a.id != id);
            renderArtworkList();
            updatePreview();
        }

        function moveArtwork(index, direction) {
            if (direction === -1 && index > 0) {
                [artworks[index], artworks[index - 1]] = [artworks[index - 1], artworks[index]];
            } else if (direction === 1 && index < artworks.length - 1) {
                [artworks[index], artworks[index + 1]] = [artworks[index + 1], artworks[index]];
            }
            renderArtworkList();
            updatePreview();
        }

        // --- LÓGICA DE VISTA PREVIA (HTML) ---
        function updatePreview() {
            // Actualizar portada
            document.getElementById('prevArtist').textContent = inputs.artistName.value;
            document.getElementById('prevSubtitle').textContent = inputs.subtitle.value;
            document.getElementById('prevUpdate').textContent = inputs.updateText.value;
            document.getElementById('prevLegal').textContent = inputs.legalNote.value;

            // Limpiar contenedor (manteniendo solo la portada que es estática en el DOM inicial, 
            // pero para simplificar, reconstruiremos todo)
            previewContainer.innerHTML = '';

            // 1. Renderizar Portada
            const coverDiv = document.createElement('div');
            coverDiv.className = 'preview-page p-12 flex flex-col justify-between items-center text-center font-serif-cat';
            coverDiv.innerHTML = `
                <div class="flex-1 flex flex-col justify-center w-full">
                    <h1 class="text-5xl tracking-widest mb-4 uppercase">${inputs.artistName.value}</h1>
                    <div class="w-full h-px bg-gray-300 my-2"></div>
                    <h2 class="text-xl tracking-wide uppercase mt-2">${inputs.subtitle.value}</h2>
                    <div class="w-full h-px bg-gray-300 my-2"></div>
                </div>
                <div class="w-full pb-10">
                    <div class="border border-red-200 border-dashed p-1 inline-block">
                        <p class="text-sm font-bold tracking-widest uppercase border-t border-b border-gray-800 py-1 inline-block text-red-600">${inputs.updateText.value}</p>
                    </div>
                    <p class="text-xs text-gray-500 mt-4 italic px-10">${inputs.legalNote.value}</p>
                </div>
            `;
            previewContainer.appendChild(coverDiv);

            // 2. Renderizar Páginas de Obra
            artworks.forEach((art, i) => {
                const page = document.createElement('div');
                page.className = 'preview-page p-12 flex flex-col justify-between font-serif-cat';
                
                // Construir la línea única de datos
                const singleLineData = `"${art.title}" | ${art.medium} | ${art.dimensions} | ${art.code}`;
                
                // Footer text
                const footerText = `${inputs.artistName.value} | ${inputs.footerAvailability.value} | pag.${i + 1}`;

                page.innerHTML = `
                    <div class="flex-1 w-full flex items-center justify-center overflow-hidden mb-6 relative">
                        <img src="${art.image}" class="max-h-full max-w-full object-contain shadow-sm">
                    </div>
                    
                    <div class="w-full">
                        <div class="border-t border-gray-300 pt-2 mb-8">
                            <div class="border border-red-200 border-dashed p-1 inline-block w-full text-right">
                                <p class="text-lg text-right w-full text-red-600">${singleLineData}</p>
                            </div>
                        </div>
                        
                        <div class="flex justify-end border-t border-gray-300 pt-2">
                             <div class="border border-red-200 border-dashed p-1 inline-block">
                                <p class="text-xs text-gray-500 italic text-red-600">${footerText}</p>
                             </div>
                        </div>
                    </div>
                `;
                previewContainer.appendChild(page);
            });
        }

        // --- GENERACIÓN DE PDF (JSPDF) ---
        async function generatePDF() {
            const btn = document.getElementById('generateBtn');
            const loader = document.getElementById('loader');
            
            try {
                loader.classList.remove('hidden');
                
                // Crear documento A4
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                const pageWidth = doc.internal.pageSize.getWidth(); // 210mm
                const pageHeight = doc.internal.pageSize.getHeight(); // 297mm
                const margin = 20;

                // --- PÁGINA 1: PORTADA ---
                doc.setFont("times", "roman"); // Times New Roman
                
                // Título
                doc.setFontSize(42);
                doc.setTextColor(0, 0, 0);
                doc.text(inputs.artistName.value.toUpperCase(), pageWidth / 2, pageHeight / 2 - 20, { align: "center" });

                // Líneas decorativas (simulando las líneas azules del diseño original)
                doc.setDrawColor(150, 150, 150);
                doc.setLineWidth(0.2);
                doc.line(margin, pageHeight / 2 - 10, pageWidth - margin, pageHeight / 2 - 10);
                
                // Subtítulo
                doc.setFontSize(14);
                doc.text(inputs.subtitle.value.toUpperCase(), pageWidth / 2, pageHeight / 2, { align: "center" });
                
                doc.line(margin, pageHeight / 2 + 5, pageWidth - margin, pageHeight / 2 + 5);

                // Footer Portada (Fecha actualización)
                doc.setFontSize(10);
                doc.text(inputs.updateText.value.toUpperCase(), pageWidth / 2, pageHeight - 40, { align: "center" });
                
                // Nota legal
                doc.setFontSize(8);
                doc.setFont("times", "italic");
                doc.setTextColor(100, 100, 100);
                const splitLegal = doc.splitTextToSize(inputs.legalNote.value, pageWidth - (margin * 3));
                doc.text(splitLegal, pageWidth / 2, pageHeight - 25, { align: "center" });

                // --- PÁGINAS DE OBRA ---
                for (let i = 0; i < artworks.length; i++) {
                    doc.addPage();
                    const art = artworks[i];
                    
                    // Cargar imagen
                    const imgProps = await getImageProperties(art.image);
                    
                    // Cálculo de dimensiones para la imagen (max 150mm alto, width full margin)
                    const maxWidth = pageWidth - (margin * 2); // 170mm
                    const maxHeight = 180; // Dejar espacio para pie de página
                    
                    let finalW = maxWidth;
                    let finalH = (imgProps.height * maxWidth) / imgProps.width;

                    if (finalH > maxHeight) {
                        finalH = maxHeight;
                        finalW = (imgProps.width * maxHeight) / imgProps.height;
                    }

                    // Centrar imagen
                    const xPos = (pageWidth - finalW) / 2;
                    const yPos = margin + ((maxHeight - finalH) / 2); // Centrado vertical en la zona superior

                    doc.addImage(art.image, 'JPEG', xPos, yPos, finalW, finalH);

                    // Línea separadora
                    const lineY = pageHeight - 50;
                    doc.setDrawColor(200, 200, 200);
                    doc.line(margin, lineY, pageWidth - margin, lineY);

                    // Caption: UNA SOLA LÍNEA
                    // "Quantum III" | óleo sobre tela | 180 x 130 cm | COX
                    const caption = `"${art.title}" | ${art.medium} | ${art.dimensions} | ${art.code}`;
                    
                    doc.setFont("times", "roman");
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    // Alinear a la derecha según el diseño
                    doc.text(caption, pageWidth - margin, lineY + 8, { align: "right" });

                    // Pie de página con número
                    // Carlos Oviedo | Obra disponible Diciembre 2024 | pag.3
                    const footerY = pageHeight - 15;
                    const pageNum = i + 1;
                    const footerText = `${inputs.artistName.value} | ${inputs.footerAvailability.value} | pag.${pageNum}`;
                    
                    doc.line(margin, footerY - 5, pageWidth - margin, footerY - 5);
                    doc.setFontSize(9);
                    doc.setTextColor(80, 80, 80);
                    doc.text(footerText, pageWidth - margin, footerY, { align: "right" });
                }

                // Guardar PDF
                const fileName = `Catalogo_${inputs.artistName.value.replace(/\s+/g, '_')}.pdf`;
                doc.save(fileName);

            } catch (error) {
                console.error(error);
                alert("Hubo un error al generar el PDF. Intenta con imágenes más ligeras.");
            } finally {
                loader.classList.add('hidden');
            }
        }

        // Helper para obtener dimensiones de imagen
        function getImageProperties(src) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve({ width: img.width, height: img.height });
                img.src = src;
            });
        }

        // Inicializar
        updatePreview();

    </script>
</body>
</html>